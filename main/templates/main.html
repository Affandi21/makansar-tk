{% extends 'base.html' %}
{% block meta %}
<title>MAKANSAR</title>
{% endblock meta %}

{% block content %}
{% include 'navbar.html' %}

<html>
 <head>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet"/>
 </head>
 <body class="bg-gray-100 font-roboto">
  <div class="max-w-7xl mx-auto p-6">
   <h1 class="text-3xl font-bold mb-6">Daftar Produk Favorit</h1>
   
   {% if product_entries %}
   <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for product_entry in product_entries %}
    <div class="bg-white rounded-lg shadow p-6 relative">
     <div class="text-xl font-semibold mb-2">{{ product_entry.food_name }}</div>
     <div class="text-lg font-semibold text-gray-700 mb-2">Harga: Rp{{ product_entry.price }}</div>
     <div class="text-sm text-gray-600 mb-2">Rating: {{ product_entry.rating_default }} / 5</div>
     <button class="absolute top-4 right-4 text-gray-500 hover:text-red-500" onclick="toggleFavorite(this, {{ product_entry.id }})">
      <i class="fas fa-heart {% if product_entry.is_favorite %}text-red-500{% else %}text-gray-500{% endif %}"></i>
     </button>
    </div>
    {% endfor %}
   </div>
   {% else %}
   <p>Belum ada data produk favorit pada mental health tracker.</p>
   {% endif %}
  </div>
  
  <script>
   function toggleFavorite(button, productId) {
    const icon = button.querySelector('i');
    const isCurrentlyFavorite = icon.classList.contains('text-red-500');
    
    if (!isCurrentlyFavorite) {
     // If it's gray (not favorite), add to favorites
     fetch(`/favorite/add/${productId}/`, {  // Updated URL path
      method: 'POST',
      headers: {
       'X-CSRFToken': '{{ csrf_token }}'
      }
     }).then(response => {
      if (response.ok) {
       icon.classList.remove('text-gray-500');
       icon.classList.add('text-red-500');
       return response.json();
      }
      throw new Error('Gagal menambahkan ke favorit');
     }).then(data => {
      console.log(data.message);
     }).catch(error => {
      console.error(error);
     });
    } else {
     // If it's red (favorite), remove from favorites
     fetch(`/favorite/delete_favorite/${productId}/`, {  // URL path already correct
      method: 'POST',
      headers: {
       'X-CSRFToken': '{{ csrf_token }}'
      }
     }).then(response => {
      if (response.ok) {
       icon.classList.remove('text-red-500');
       icon.classList.add('text-gray-500');
       return response.json();
      }
      throw new Error('Gagal menghapus dari favorit');
     }).then(data => {
      console.log(data.message);
     }).catch(error => {
      console.error(error);
     });
    }
   }
  </script>
 </body>
</html>

{% endblock content %}